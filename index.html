<html>
<head>
	<title>Ivan Game</title>
	<link rel='icon' type='image/x-icon' href='favicon.ico'>
	<style>
		body    { margin: auto; text-align: center;}
		.card	{ height: 25px; width: 25px; display: inline-block; margin: 5px;}
		.deck   { margin: auto; width: 800px; }
		#actionDescription { margin: auto; width: 300px }
		#topCard { border-style: solid; }
	</style>
</head>
<body>
	<h1>
		Ivan Game
	</h1>
	<div id='state'>
		<h3>Player 1</h3>
		<div class='deck' id="player1"></div>
		<br>
		<h3>Player 2</h3>
		<div class='deck' id="player2"></div>
	</div>
	<br>
	<div id="playerDisplay">
		Player 1's Turn:
	</div>
	<div id='buttons'>
		<button class="button" id="actionButton">
			Action
		</button>
		<button class="button" id="promoteButton">
			Upgrade
		</button>
		<button class="button" id="passButton">
			Pass
		</button>
	</div>
	<br>
	<div id="actionDescription">
	</div>
	<div id="display">
	</div>
<script type="text/javascript">
	
let numPlayers = 2
let deckState = []
let graveyardState = []
let currentPlayer = 0
for (i = 0; i < numPlayers; i++) {
	deckState[i] = [['R', 1], ['G', 1], ['Y', 1], ['B', 1], ['R', 1], ['G', 1], ['Y', 1], ['B', 1]]; 
	graveyardState[i] = ['R', 'G', 'Y', 'B'];
}

get('promoteButton').onclick = function() {
	play('promote')
}

get('passButton').onclick = function() {
	play('pass')
}

get('actionButton').onclick = function() {
	play('action')
}

// idea - each card has unique index 1-n.
// so we just store decks as: [1,3,2,4] etc.
// and have a map of cardIndex to powerlevel. (-x = graveyard, x is player #)
// color is determined by mod.

function printState() {
	for (i = 0; i < numPlayers; i++) {
		let playerDeck = get("player" + (i + 1))
		playerDeck.innerHTML = ''
		for (j = 0; j < deckState[i].length; j++) {
			let card = document.createElement('div')
			card.setAttribute('class', 'card')
			card.style.backgroundColor = getColor(deckState[i][j][0])
			if (i == currentPlayer && j == 0) {
				card.setAttribute('id', 'topCard')
			}
			card.innerHTML = deckState[i][j][1]
			playerDeck.appendChild(card)
		}
	}
	let color = getColor(deckState[currentPlayer][0][0])
	get('actionDescription').innerHTML = color + " " + deckState[currentPlayer][0][1] + " Action: \n" + getDescription(deckState[currentPlayer][0])
	get('actionDescription').style.backgroundColor = color
}
printState()

function play(operation) {
	switch (operation) {
		case 'action' :
			action()
			break
		case 'promote' :
			promote()
			break
		case 'pass' :
			pass()
			break
	}
	currentPlayer = currentPlayer == numPlayers - 1 ? 0 : currentPlayer + 1
	printState()
	get('playerDisplay').innerHTML = "Player " + (currentPlayer + 1) + "'s turn:"
}


function pass() {
	currentDeck = deckState[currentPlayer];
	currentDeck.push(currentDeck[0])
	currentDeck.shift()
}

function promote() {
	pass()
	if (currentDeck[currentDeck.length - 1][1] < 4) {
		currentDeck[currentDeck.length - 1][1]++
	}
}

function action(level = 0) {
	
	let cardToPlay = deckState[currentPlayer][0]
	let color = cardToPlay[0]
	
	if (level == 0) { //otherwise, played as a blue
		let level = cardToPlay[1]
	}

	pass()

	currentDeck = deckState[currentPlayer]

	switch (color) {
		case 'R' :
			switch (level) {
				case 1: 
					break
				case 2:
					break
				case 3:
					break
				case 4:
					break
			}
		case 'G': 
			switch (level) {
				case 1: // Give this card.
					if (numPlayers != 2) {
						//select player
					}
					var otherPlayer = currentPlayer == 1 ? 0 : 1
					deckState[otherPlayer].push(currentDeck.pop())
					break
				case 2: // Give your top card.
					if (numPlayers != 2) {
						//select player
					}
					var otherPlayer = currentPlayer == 1 ? 0 : 1
					deckState[otherPlayer].push(currentDeck.shift())
					break
				case 3: // Give one of your cards. Set it to level 2.
					// select card to give 
					cardToGive = selectCard(player, level)

					
				case 4: // Bury a top card.
					// select card to bury
			}
			break
		case 'Y':
			switch (level) {
				case 1: // Swap the top two cards in one deck. Or, swap the top cards from two opponents decks.
					
					break
				case 2: // Move a top card anywhere within a deck.
					// 1. Select top card
					// 2. Select index in deck
					break
				case 3: // Move any other card anywhere within a deck.
					// 1. Select a card
					// 2. Select index in deck
					break
				case 4: // Move a card anywhere within a deck (including this card).
					// 1. Select a card
					// 2. Select index in deck
					break
			}
			break
		case 'B':
			// Copy a top card.

	}
}


//selectableCards is a 2d array, where [player index][cards]
function selectCard(players, level, onlyTopCards, exclude) {
	get('display').innerHTML = "Select a card"
	for (let player = 0; player < numPlayers; player++) {
		for (let cardIndex = 0; cardIndex < deckState[player].length; cardIndex++) {
			if (players.includes(player) && 
				deckState[player][cardIndex][1] 
				) {

			} else {
				
			}
			
		}
	}
	
}


function getDescription(card) {
	let color = card[0]
	let level = card[1]
	switch (color) {
		case 'R' :
			switch (level) {
				case 1: return "Steal an opponent's top card."
				case 2: return "Unearth a card from a graveyard. Set it to level 2."
				case 3: return "Steal an opponent's card. If it's level 2 or higher, set it to level 2."
				case 4: return "Take 2 turns."
			}
		case 'Y':
			switch (level) {
				case 1: return 'Swap the top two cards in one deck. Or, swap the top cards from two opponents decks.'
				case 2: return 'Move a top card anywhere within a deck.'
				case 3: return 'Move any other card anywhere within a deck.'
				case 4: return 'Move a card anywhere within a deck (including this card).'
			}
		case 'G':
			switch (level) {
				case 1: return 'Give this card.'
				case 2: return 'Give your top card.'
				case 3: return 'Give one of your cards. Set it to level 2.'
				case 4: return 'Bury a top card.'
			}
		case 'B': return 'Copy a top card.'
	}
}

function getColor(color) {
	switch (color) {
		case 'R': return 'Red'
		case 'Y': return 'Yellow'
		case 'G': return 'Green'
		case 'B': return 'Blue'
	}
}

function get(id) {
	return document.getElementById(id)
}
</script>

</body>